function gCode(){this.canvas=document.getElementById("myCanvas"),this.context=this.canvas.getContext("2d"),this.info=document.getElementById("myInfo"),this.radioInput=document.getElementsByClassName("radio"),this.canvasWidth=.8*window.screen.width,this.canvasHeight=this.canvasWidth,this.spacing=this.canvasWidth/4,this.radius=.3*this.spacing,this.status="set",this.allPoints=[],this.paintedPoints=[],this.unpaintedPoints=[],this.paintedPointsXY=[],this.readyToSaveCode=[],this.savedCode=[],this.touchIsValid=!1,this.touchEvent="",this.touchPosition={},this.setCanvas(),this.setRound("init"),this.showInfo(1),this.touchDetection(),this.radioDetection()}gCode.prototype.setCanvas=function(){this.canvas.setAttribute("width",this.canvasWidth),this.canvas.setAttribute("height",this.canvasHeight)},gCode.prototype.setRound=function(t){for(var i=1;i<=3;i++)for(var s=1;s<=3;s++){var e={X:s*this.spacing,Y:i*this.spacing,index:s+3*(i-1)};this.drawRound(e.X,e.Y),t&&(this.allPoints.push(e),this.unpaintedPoints.push(e.index))}},gCode.prototype.showInfo=function(t){switch(t){case 0:this.info.innerHTML="正在输入...";break;case 1:this.info.innerHTML="请输入手势密码";break;case 2:this.info.innerHTML="请再次输入手势密码";break;case 3:this.info.innerHTML="密码太短，至少需要5个点";break;case 4:this.info.innerHTML="密码设置成功";break;case 5:this.info.innerHTML="两次输入的不一致";break;case 6:this.info.innerHTML="密码正确！";break;case 7:this.info.innerHTML="输入的密码不正确"}},gCode.prototype.touchDetection=function(){var t=this;this.canvas.addEventListener("touchstart",function(i){t.touchEvent="start",t.checkPosition(i)},!1),this.canvas.addEventListener("touchmove",function(i){t.touchIsValid&&(t.showInfo(0),t.touchEvent="move",t.checkPosition(i))},!1),this.canvas.addEventListener("touchend",function(i){if(t.touchIsValid){switch(t.status){case"set":t.setCode();break;case"repeat":t.repeatCode();break;case"validate":t.validateCode()}setTimeout(function(){t.refresh(),t.showInfo(1)},1e3)}},!1)},gCode.prototype.radioDetection=function(){var t=this;this.radioInput[0].addEventListener("click",function(){t.status="set",t.refresh()},!1),this.radioInput[1].addEventListener("click",function(){t.status="validate",t.refresh()},!1)},gCode.prototype.checkPosition=function(t){var i=t.touches[0],s=t.currentTarget.getBoundingClientRect();this.touchPosition={touchX:Number(i.pageX)-s.left,touchY:Number(i.pageY)-s.top};for(var e=0;e<this.allPoints.length;e++)if(Math.abs(this.touchPosition.touchX-this.allPoints[e].X)<=this.radius&&Math.abs(this.touchPosition.touchY-this.allPoints[e].Y)<=this.radius)if("start"==this.touchEvent)this.touchIsValid=!0;else if("move"==this.touchEvent&&1==this.touchIsValid&&this.unpaintedPoints.indexOf(this.allPoints[e].index)>=0){this.paintedPoints.push(this.allPoints[e].index);var n={paintedX:this.allPoints[e].X,paintedY:this.allPoints[e].Y};this.paintedPointsXY.push(n),this.unpaintedPoints.splice(this.unpaintedPoints.indexOf(this.allPoints[e].index),1)}"move"==this.touchEvent&&1==this.touchIsValid&&(this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.setRound(),this.fillRound(),this.drawLine())},gCode.prototype.drawRound=function(t,i){this.context.strokeStyle="#ccc",this.context.fillStyle="#fff",this.context.lineWidth=2,this.context.beginPath(),this.context.arc(t,i,this.radius+1,0,2*Math.PI,!0),this.context.closePath(),this.context.stroke(),this.context.fill()},gCode.prototype.drawLine=function(){this.context.strokeStyle="#b34242",this.context.lineWidth=1.5,this.context.beginPath(),this.context.moveTo(this.paintedPointsXY[0].paintedX,this.paintedPointsXY[0].paintedY);for(var t=1;t<this.paintedPoints.length;t++)this.context.lineTo(this.paintedPointsXY[t].paintedX,this.paintedPointsXY[t].paintedY);this.context.lineTo(this.touchPosition.touchX,this.touchPosition.touchY),this.context.stroke(),this.context.closePath()},gCode.prototype.fillRound=function(){for(var t=0;t<this.paintedPoints.length;t++)this.context.fillStyle="#fca71c",this.context.beginPath(),this.context.arc(this.paintedPointsXY[t].paintedX,this.paintedPointsXY[t].paintedY,this.radius+2,0,2*Math.PI,!0),this.context.closePath(),this.context.fill()},gCode.prototype.setCode=function(){this.paintedPoints.length>4?(this.readyToSaveCode=this.paintedPoints,this.showInfo(2),this.status="repeat"):this.showInfo(3)},gCode.prototype.repeatCode=function(){var t=!0;if(this.paintedPoints.length!=this.readyToSaveCode.length)this.showInfo(5),this.status="set";else{for(var i=0;i<this.paintedPoints.length;i++)if(this.paintedPoints[i]!=this.readyToSaveCode[i]){t=!1;break}1==t?(console.log("aaa"),window.localStorage.setItem("gestureCode",JSON.stringify(this.readyToSaveCode)),this.showInfo(4)):(this.showInfo(5),this.status="set")}},gCode.prototype.validateCode=function(){var t=!0;if(this.savedCode=JSON.parse(window.localStorage.getItem("gestureCode")),console.log(this.savedCode),console.log(this.paintedPoints),this.paintedPoints.length!=this.savedCode.length)this.showInfo(7);else{for(var i=0;i<this.paintedPoints.length;i++)if(this.paintedPoints[i]!=this.savedCode[i]){t=!1;break}1==t?this.showInfo(6):this.showInfo(7)}},gCode.prototype.refresh=function(){this.allPoints=[],this.paintedPoints=[],this.unpaintedPoints=[],this.paintedPointsXY=[],this.touchIsValid=!1,this.touchEvent="",this.touchPosition={},this.setCanvas(),this.setRound("again")};var newCode=new gCode;